apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ .Values.project }}-registry-secret-vso
  namespace: {{ .Values.project }}
spec:
  type: kv-v2
  mount: shared
  path: registry/harbor
  destination:
    name: registry-secret
    create: true
    type: kubernetes.io/dockerconfigjson
  vaultAuthRef: {{ .Values.project }}-vault-auth
  refreshAfter: 300s
  transformation:
    templates:
      .dockerconfigjson: |
        {
          "auths": {
            "{{ "{{" }} .Secrets.url {{ "}}" }}": {
              "username": "{{ "{{" }} .Secrets.username {{ "}}" }}",
              "password": "{{ "{{" }} .Secrets.password {{ "}}" }}"
            }
          }
        }
